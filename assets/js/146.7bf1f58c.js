(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{501:function(s,t,a){"use strict";a.r(t);var n=a(8),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"给阿里云docker中的nginx配置ssl证书开启https服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#给阿里云docker中的nginx配置ssl证书开启https服务"}},[s._v("#")]),s._v(" 给阿里云docker中的Nginx配置SSL证书开启https服务")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("文章更新历史")]),s._v(" "),t("p",[s._v("2022/05/29 fix:目前无法访问 https 问题已解决，根源是 docker 的443 端口忘了放。")])]),s._v(" "),t("h2",{attrs:{id:"申请-ssl-证书"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#申请-ssl-证书"}},[s._v("#")]),s._v(" 申请 SSL 证书")]),s._v(" "),t("p",[s._v("我申请的是免费版的，阿里云支持 1 年申请一次，最多部署 20 个。")]),s._v(" "),t("p",[s._v("地址：")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://common-buy.aliyun.com/?spm=5176.b657008.0.0.6f7f799dnh4e4y&commodityCode=cas_dv_public_cn&request=%7B%22product%22%3A%22free_product%22%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("阿里云免费 SSL 证书购买"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("然后可以下载部署")]),s._v(" "),t("p",[s._v("证书管理地址：")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://yundunnext.console.aliyun.com/?spm=5176.21213303.782131.4.738053c95GQkOa&p=cas&accounttraceid=c954f613b8a9412a81fb55251881911besdq#/certExtend/free",target:"_blank",rel:"noopener noreferrer"}},[s._v("免费 SSL 证书管理"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("我下载的是 nginx 版本。同时支持的还有 tomcat、Apache、IIS 等。")]),s._v(" "),t("h2",{attrs:{id:"上传者证书到服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#上传者证书到服务器"}},[s._v("#")]),s._v(" 上传者证书到服务器")]),s._v(" "),t("p",[s._v("我是把它放到项目目录，后面用 docker 的 volume 去映射，这样可以免去上传的麻烦。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/terwer/upload/img/20220529023356.png",alt:"image-20220529023356152"}})]),s._v(" "),t("h2",{attrs:{id:"安装-nginx-的-ssl-模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-nginx-的-ssl-模块"}},[s._v("#")]),s._v(" 安装 Nginx 的 ssl 模块")]),s._v(" "),t("p",[s._v("检查Nginx 的 SSL 模块")]),s._v(" "),t("p",[s._v("安装 vscode 的 SSH 远程扩展和 docker 扩展，然后打开 docker 容器 shell")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/terwer/upload/img/20220529001634.png",alt:"image-20220529001634461"}})]),s._v(" "),t("p",[s._v("输入以下命令")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("结果如下")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Executing task: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" 154d27fd10c46b46958c05edc8736e73ba2e8618b23b6d615db3a532077b2250 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("\n\n/ "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx -V")]),s._v("\nnginx version: nginx/1.15.9\nbuilt by gcc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.2")]),s._v(".0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Alpine "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.2")]),s._v(".0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nbuilt with OpenSSL "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".1a  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\nTLS SNI support enabled\nconfigure arguments: "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/nginx --sbin-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/nginx --modules-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/lib/nginx/modules --conf-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/nginx/nginx.conf --error-log-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/nginx/error.log --http-log-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/nginx/access.log --pid-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/nginx.pid --lock-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/nginx.lock --http-client-body-temp-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/cache/nginx/client_temp --http-proxy-temp-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/cache/nginx/proxy_temp --http-fastcgi-temp-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/cache/nginx/uwsgi_temp --http-scgi-temp-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/cache/nginx/scgi_temp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--group")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-http_xslt_module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dynamic --with-http_image_filter_module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dynamic --with-http_geoip_module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dynamic --with-threads --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-stream_realip_module --with-stream_geoip_module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dynamic --with-http_slice_module --with-mail --with-mail_ssl_module --with-compat --with-file-aio --with-http_v2_module\n/ "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("如果出现 "),t("code",[s._v("configure arguments: –with-http_ssl_module")]),s._v(" , 则已安装（下面的步骤可以跳过，进入 nginx.conf 配置）。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/terwer/upload/img/20220529002414.png",alt:"image-20220529002413870"}})]),s._v(" "),t("p",[s._v("可以看到 docker 版的 nginx 已经包含了 https 模块，我们只需要配置即可。如果是自安装版本需要自己下载 https 模块安装。")]),s._v(" "),t("h2",{attrs:{id:"nginx-conf-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-conf-配置"}},[s._v("#")]),s._v(" Nginx.conf 配置")]),s._v(" "),t("p",[s._v("打开 nginx.conf 文件，新增 https 的 server：")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器端口使用443，开启ssl, 这里ssl就是上面安装的ssl模块")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("charset")]),s._v(" utf-8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 域名，多个以空格分开")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  terwergreen.com www.terwergreen.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssl证书地址")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate")]),s._v("      /etc/ssl/certs/cert.pem")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pem文件的路径")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate_key")]),s._v("  /etc/ssl/certs/cert.key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# key文件的路径")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssl验证相关配置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_timeout")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓存有效期")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_ciphers")]),s._v(" ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#加密算法")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_protocols")]),s._v(" TLSv1 TLSv1.1 TLSv1.2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安全链接可选的加密协议")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_prefer_server_ciphers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用服务器端的首选算法")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对应静态资源文件夹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /usr/local/docker/nginx/www")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对应首页")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解决登录之后刷新404")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# try_files $uri $uri/ /index.html;")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if ($new_uri) {")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     return 301 $new_uri;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# }")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("h2",{attrs:{id:"docker-的目录映射"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-的目录映射"}},[s._v("#")]),s._v(" docker 的目录映射")]),s._v(" "),t("p",[s._v("注意映射证书路径")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bugucms-nginx")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bugucms/nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.15.9\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bugucms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dockerfile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./bugucms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx/Dockerfile\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"80:80"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"443:443"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./bugucms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx/nginx.conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/nginx/conf.d/default.conf\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./bugucms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx/data/nginx/log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/log/nginx\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./bugucms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx/ssl/certs/cert.pem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/ssl/certs/cert.pem\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./bugucms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx/ssl/certs/cert.key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/ssl/certs/cert.key\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /var/lib/jenkins/workspace/gitee"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pages"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/local/docker/nginx/www\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h2",{attrs:{id:"网络安全组放开-443-端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#网络安全组放开-443-端口"}},[s._v("#")]),s._v(" 网络安全组放开 443 端口")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/terwer/upload/img/20220529004745.png",alt:"image-20220529004744658"}})]),s._v(" "),t("h2",{attrs:{id:"重启-nginx-验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重启-nginx-验证"}},[s._v("#")]),s._v(" 重启 Nginx 验证")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--build")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("直接重新开启 jenkins 部署也可以")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/terwer/upload/img/20220529004510.png",alt:"image-20220529004509860"}})]),s._v(" "),t("h2",{attrs:{id:"验证-https-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证-https-服务"}},[s._v("#")]),s._v(" 验证 https 服务")]),s._v(" "),t("p",[s._v("原来的 http 模式")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/terwer/upload/img/20220529025532.png",alt:"image-20220529025532140"}})]),s._v(" "),t("p",[s._v("加上 https 之后")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/terwer/upload/img/20220529024835.png",alt:"image-20220529024835242"}})]),s._v(" "),t("p",[s._v("可以看到，网站前面已经有一把锁了，https 部署成功。Yeah~")]),s._v(" "),t("h2",{attrs:{id:"后续"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#后续"}},[s._v("#")]),s._v(" 后续")]),s._v(" "),t("p",[s._v("为了适应 https 的潮流，我们可以更进一步，将 http 重定向 https。")]),s._v(" "),t("p",[s._v("只需要加上下面的 301 跳转代码即可。")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  terwergreen.com www.terwergreen.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" https://"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_name")]),s._v("$ request_uri")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"后记"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#后记"}},[s._v("#")]),s._v(" 后记")]),s._v(" "),t("p",[s._v("一个乌龙，之前一致无法访问，还以为是阿里云的问题，后来，"),t("strong",[s._v("无意间发现是我 docker 的443端口没开")]),s._v("，汗。。。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/terwer/upload/img/20220529024558.png",alt:"image-20220529024557848"}})]),s._v(" "),t("p",[s._v("细心！细心！细心！切记~")])])}),[],!1,null,null,null);t.default=e.exports}}]);