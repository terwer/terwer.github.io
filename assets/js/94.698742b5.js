(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{451:function(a,s,e){"use strict";e.r(s);var t=e(8),n=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("blockquote",[s("p",[s("strong",[a._v("文章更新历史")])]),a._v(" "),s("p",[a._v("2022/05/25 feat:初稿。")])]),a._v(" "),s("h1",{attrs:{id:"zookeeper-的环境搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper-的环境搭建"}},[a._v("#")]),a._v(" Zookeeper 的环境搭建")]),a._v(" "),s("p",[a._v("Zookeeper 的安装方式有三种：单机模式、集群模式和伪集群模式。")]),a._v(" "),s("ul",[s("li",[a._v("单机模式：Zookeeper 只运行在一台服务器上，适合测试环境。")]),a._v(" "),s("li",[a._v("集群模式：Zookeeper 运行于一个集群上，适合生产环境，这个计算机集群被称为一个“集合体”。")]),a._v(" "),s("li",[a._v("伪集群模式：就是在一台服务器上运行多个 Zookeeper 实例。")])]),a._v(" "),s("h2",{attrs:{id:"单机模式搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单机模式搭建"}},[a._v("#")]),a._v(" 单机模式搭建")]),a._v(" "),s("h3",{attrs:{id:"普通搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#普通搭建"}},[a._v("#")]),a._v(" 普通搭建")]),a._v(" "),s("p",[a._v("zookeeper 官网")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://zookeeper.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://zookeeper.apache.org/"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("下载 Zookeeper，最新稳定版是3.7.1")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /app\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://dlcdn.apache.org/zookeeper/zookeeper-3.7.1/apache-zookeeper-3.7.1-bin.tar.gz\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("解压")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" apache-zookeeper-3.7.1-bin.tar.gz\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("运行")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" apache-zookeeper-3.7.1-bin\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" data\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" conf\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" zoo_sample.cfg zoo.cfg\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" zoo.cfg\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("修改配置如下")]),a._v(" "),s("div",{staticClass:"language-ini line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# the directory where the snapshot is stored.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# do not use /tmp for storage, /tmp here is just ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# example sakes.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/app/apache-zookeeper-3.7.1-bin/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# the port at which the clients will connect")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2181")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("启动")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" bin\n./zkServer.sh start\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("效果")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("➜  bin ./zkServer.sh start\nZooKeeper JMX enabled by default\nUsing config: /app/apache-zookeeper-3.7.1-bin/bin/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/conf/zoo.cfg\nStarting zookeeper "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(". STARTED\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("查看状态")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("./zkServer.sh status\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("➜  bin ./zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /app/apache-zookeeper-3.7.1-bin/bin/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/conf/zoo.cfg\nClient port found: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2181")]),a._v(". Client address: localhost. Client SSL: false.\nMode: standalone\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h3",{attrs:{id:"docker-方式搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-方式搭建"}},[a._v("#")]),a._v(" docker 方式搭建")]),a._v(" "),s("p",[a._v("官方镜像地址：")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://hub.docker.com/_/zookeeper",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://hub.docker.com/_/zookeeper"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("Dockerfile")]),a._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" zookeeper:3.8")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("docker-compose.yml")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'3'")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("zoo1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" terwer/zookeeper\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" portable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("zookeeper\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" .\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dockerfile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Dockerfile\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" zoo1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2181")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ZOO_MY_ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ZOO_SERVERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" server.1=zoo1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3888;2181\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])]),s("h2",{attrs:{id:"伪集群模式搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#伪集群模式搭建"}},[a._v("#")]),a._v(" 伪集群模式搭建")]),a._v(" "),s("p",[a._v("伪集群模式是在同一机器上运行多个 Zookeeper 实例来模拟多个 Zookeeper 集群的情况，操作简单，便于开发和测试阶段调试。")]),a._v(" "),s("p",[a._v("伪集群模式需要注意的问题：")]),a._v(" "),s("p",[a._v("1、要保证端口不能冲突。")]),a._v(" "),s("p",[a._v("2、dataDir 的路径不能相同。")]),a._v(" "),s("p",[a._v("3、dataDir 需要创建 myid 文件夹来标识对应的 Zookeeper 服务器实例。")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("clientPort 端口")]),a._v(" "),s("p",[a._v("监听的端口要独立")])]),a._v(" "),s("li",[s("p",[a._v("dataDir 和 dataLogDir")]),a._v(" "),s("p",[a._v("数据文件和日志文件要分别存储")])]),a._v(" "),s("li",[s("p",[a._v("Server.X 和 myid")])])]),a._v(" "),s("p",[a._v("Server.X 中的 X 对应 data/myid 中的 id 。")]),a._v(" "),s("h3",{attrs:{id:"下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载"}},[a._v("#")]),a._v(" 下载")]),a._v(" "),s("p",[a._v("参考普通模式")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /media/terwer/data/app\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://dlcdn.apache.org/zookeeper/zookeeper-3.7.1/apache-zookeeper-3.7.1-bin.tar.gz\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"解压-创建集群目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解压-创建集群目录"}},[a._v("#")]),a._v(" 解压，创建集群目录")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" zkcluster\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" apache-zookeeper-3.7.1-bin.tar.gz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /media/terwer/data/app/zkcluster\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"复制并改名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#复制并改名"}},[a._v("#")]),a._v(" 复制并改名")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" zkcluster\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" apache-zookeeper-3.7.1-bin zookeeper01\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" zookeeper01/ zookeeper02\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" zookeeper01/ zookeeper03\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://ghproxy.com/https://raw.githubusercontent.com/terwer/upload/main/img/20220601185111.png",alt:"image-20220601185111062"}})]),a._v(" "),s("h3",{attrs:{id:"分别在-zookeeper01-、zookeeper02-、zookeeper03-目录下创建-data-和-logs-目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分别在-zookeeper01-、zookeeper02-、zookeeper03-目录下创建-data-和-logs-目录"}},[a._v("#")]),a._v(" 分别在 zookeeper01 、zookeeper02 、zookeeper03 目录下创建 data 和 logs 目录")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" data\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" logs\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"修改配置文件名称"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件名称"}},[a._v("#")]),a._v(" 修改配置文件名称")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" conf\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" zoo_sample.cfg zoo.cfg\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"修改每一个-zookeeper-的-datadir、datalogdir-和-clientport-端口分别为2181、2182、2183"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改每一个-zookeeper-的-datadir、datalogdir-和-clientport-端口分别为2181、2182、2183"}},[a._v("#")]),a._v(" 修改每一个 Zookeeper 的 DataDir、DataLogDir 和 ClientPort，端口分别为2181、2182、2183")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/media/terwer/data/app/zkcluster/zookeeper01/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dataLogDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/media/terwer/data/app/zkcluster/zookeeper01/logs")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2181")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/media/terwer/data/app/zkcluster/zookeeper02/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dataLogDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/media/terwer/data/app/zkcluster/zookeeper02/logs")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2182")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/media/terwer/data/app/zkcluster/zookeeper03/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dataLogDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/media/terwer/data/app/zkcluster/zookeeper03/logs")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2183")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"配置集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置集群"}},[a._v("#")]),a._v(" 配置集群")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("在每个集群的 data 目录下都新建一个 myid 文件，值分别为1、2、3")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" data\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("touch")]),a._v(" myid\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" myid\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("在每个 Zookeeper 的 zoo.cfg 中配置访问端口和集群列表")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.3.46:2181:2181")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.3.46:2182:2182")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.3.46:2183:2183")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# server.服务器 ID=服务器 IP 地址:服务器之间通信端口:服务器之间投票选举端口")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])])])]),a._v(" "),s("h3",{attrs:{id:"启动集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动集群"}},[a._v("#")]),a._v(" 启动集群")]),a._v(" "),s("p",[a._v("依次启动三个集群")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" bin\n./zkServer.sh start\n./zkServer.sh status\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"报错解决"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#报错解决"}},[a._v("#")]),a._v(" 报错解决")]),a._v(" "),s("h4",{attrs:{id:"错误一"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误一"}},[a._v("#")]),a._v(" 错误一")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("org.apache.zookeeper.server.quorum.QuorumPeerConfig"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$ConfigException")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" Client and election port must be different"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" Please update the configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v(" on server.3\n        at org.apache.zookeeper.server.quorum.QuorumPeer"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$QuorumServer")]),a._v(".initializeWithAddressString"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("QuorumPeer.java:362"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.zookeeper.server.quorum.QuorumPeer"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$QuorumServer")]),a._v("."),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("init"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("QuorumPeer.java:279"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.zookeeper.server.quorum.QuorumPeer"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$QuorumServer")]),a._v("."),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("init"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("QuorumPeer.java:274"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.zookeeper.server.quorum.flexible.QuorumMaj."),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("init"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("QuorumMaj.java:92"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.zookeeper.server.quorum.QuorumPeerConfig.createQuorumVerifier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("QuorumPeerConfig.java:658"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parseDynamicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("QuorumPeerConfig.java:689"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.zookeeper.server.quorum.QuorumPeerConfig.setupQuorumPeerConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("QuorumPeerConfig.java:663"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parseProperties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("QuorumPeerConfig.java:491"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("QuorumPeerConfig.java:194"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("QuorumPeerMain.java:125"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        at org.apache.zookeeper.server.quorum.QuorumPeerMain.main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("QuorumPeerMain.java:91"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nInvalid config, exiting abnormally\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2022")]),a._v("-06-01 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":17:55,296 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("myid:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" - INFO  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("main:ZKAuditProvider@42"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" - ZooKeeper audit is disabled.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2022")]),a._v("-06-01 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":17:55,298 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("myid:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" - ERROR "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("main:ServiceUtils@48"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" - Exiting JVM with code "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])]),s("p",[a._v("客户端端口和选举端口不能一样，换一下端口就行了。")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.3.46:2181:3181")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.3.46:2182:3182")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.3.46:2183:3183")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h4",{attrs:{id:"错误二"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误二"}},[a._v("#")]),a._v(" 错误二")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("QuorumCnxManager$Listener@7631Exception while listening java.net.BindException\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("解决方法：在三个 zoo.cfg 中加入")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("quorumListenOnAllIPs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"错误三"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误三"}},[a._v("#")]),a._v(" 错误三")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("Exception when following the leader java.io.EOFException\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("实际上，第一个问题没解决，服务端端口也不能和客户端一样。")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.3.46:2888:3888")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.3.46:2889:3889")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.3.46:2890:3890")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"查看效果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看效果"}},[a._v("#")]),a._v(" 查看效果")]),a._v(" "),s("p",[a._v("启动第一个之后")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("➜  bin ./zkServer.sh start \nZooKeeper JMX enabled by default\nUsing config: /media/terwer/data/app/zkcluster/zookeeper01/bin/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/conf/zoo.cfg\nStarting zookeeper "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(". STARTED\n➜  bin ./zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /media/terwer/data/app/zkcluster/zookeeper01/bin/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/conf/zoo.cfg\nClient port found: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2181")]),a._v(". Client address: localhost. Client SSL: false.\nError contacting service. It is probably not running.\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("p",[a._v("启动第二个之后")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("➜  bin ./zkServer.sh start \nZooKeeper JMX enabled by default\nUsing config: /media/terwer/data/app/zkcluster/zookeeper02/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n➜  bin ./zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /media/terwer/data/app/zkcluster/zookeeper02/bin/../conf/zoo.cfg\nClient port found: 2182. Client address: localhost. Client SSL: false.\nMode: leader\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("p",[a._v("启动第三个节点之后")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("➜  bin ./zkServer.sh start \nZooKeeper JMX enabled by default\nUsing config: /media/terwer/data/app/zkcluster/zookeeper03/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n➜  bin ./zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /media/terwer/data/app/zkcluster/zookeeper03/bin/../conf/zoo.cfg\nClient port found: 2183. Client address: localhost. Client SSL: false.\nMode: follower\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h2",{attrs:{id:"docker-版伪集群模式搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-版伪集群模式搭建"}},[a._v("#")]),a._v(" docker 版伪集群模式搭建")]),a._v(" "),s("p",[a._v("docker-compose.yml")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'3.1'")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("zoo1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" zookeeper\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"no"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" zoo1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2181")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ZOO_MY_ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ZOO_SERVERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" server.1=zoo1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3888;2181 server.2=zoo2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3888;2181 server.3=zoo3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3888;2181\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("zoo2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" zookeeper\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"no"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" zoo2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 2182"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2181")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ZOO_MY_ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ZOO_SERVERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" server.1=zoo1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3888;2181 server.2=zoo2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3888;2181 server.3=zoo3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3888;2181\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("zoo3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" zookeeper\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"no"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" zoo3\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 2183"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2181")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ZOO_MY_ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ZOO_SERVERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" server.1=zoo1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3888;2181 server.2=zoo2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3888;2181 server.3=zoo3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3888;2181\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br")])]),s("p",[a._v("检测")]),a._v(" "),s("p",[a._v("先 Attach Shell ，然后")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("/apache-zookeeper-3.8.0-bin/bin\n/zkServer.sh status\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("结果")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("root@zoo3:/apache-zookeeper-3.8.0-bin/bin"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ./zkServer.sh status")]),a._v("\nZooKeeper JMX enabled by default\nUsing config: /conf/zoo.cfg\nClient port found: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2181")]),a._v(". Client address: localhost. Client SSL: false.\nMode: leader\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);