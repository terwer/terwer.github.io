(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{484:function(s,n,e){"use strict";e.r(n);var t=e(8),a=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("随着设备连接数增多，单台服务器支撑的TCP长连接数有限，这个时候程序架构就需要改变，一般都会采取横向扩展，增加多台服务器程序。怎么将TCP长连接均衡的路由到不同的服务器，这个时候就需要实现负载均衡了。")]),s._v(" "),n("h2",{attrs:{id:"两种不同的场景和方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#两种不同的场景和方案"}},[s._v("#")]),s._v(" 两种不同的场景和方案")]),s._v(" "),n("p",[s._v("两种应用场景是：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("客户端实现比较简单，所有客户端都会连接同一个ip域名和端口。客户端不会去请求可用服务器列表，然后去根据具列表选择不同的服务器。比如说一些DTU等硬件设备或者因为前期没有考虑负载均衡而导致的遗留老项目。")]),s._v(" "),n("p",[n("strong",[s._v("解决方案：")])]),s._v(" "),n("p",[s._v("在目标服务器上做TCP负载均衡，转发到不同的服务器上，但是这种方案需要解决负载均衡服务器的单点故障。例如可以通过Nginx开启TCP负载均衡功能来实现。")])]),s._v(" "),n("li",[n("p",[s._v("客户端本身就实现了请求可用服务器列表，然后根据列表去连接不同的服务器。")]),s._v(" "),n("p",[n("strong",[s._v("解决方案")])]),s._v(" "),n("p",[s._v("解决方案比较多，例如可以通过 "),n("code",[s._v("Zookeeper")]),s._v(" 、"),n("code",[s._v("SpringCloud")]),s._v(" 等来实现。")])])]),s._v(" "),n("h2",{attrs:{id:"方案一-nginx实现负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方案一-nginx实现负载均衡"}},[s._v("#")]),s._v(" 方案一：Nginx实现负载均衡")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("安装Nginx")])]),s._v(" "),n("li",[n("p",[s._v("修改nginx.conf添加负载均衡配置")]),s._v(" "),n("p",[s._v("参考："),n("a",{attrs:{href:"http://nginx.org/en/docs/stream/ngx_stream_core_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://nginx.org/en/docs/stream/ngx_stream_core_module.html"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("配置如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("worker_processes  1;\n\nevents {\n    worker_connections  1024;\n}\n\n#tcp load balance\nstream{\n    # 更多更详细的参数，查看文档或网络\n    upstream netty_test{\n        server 127.0.0.1:9991 weight=1;\n        server 127.0.0.1:9992 weight=1;\n    }\n\n    server{\n        listen 9999;\n        proxy_pass netty_test;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("连接测试")]),s._v(" "),n("p",[s._v("启动两个netty服务器程序，在生产环境中会部署到不同的服务器，这里测试，在同一台PC上启动两个netty程序,端口分别为 "),n("code",[s._v("9991")]),s._v(" 和"),n("code",[s._v("9992")]),s._v("。")]),s._v(" "),n("p",[s._v("使用客户端连接 "),n("code",[s._v("127.0.0.1:9999")]),s._v(" ，当建立多个连接时，客户端会被平均路由到 "),n("code",[s._v("127.0.0.1:9991")]),s._v(" 和 "),n("code",[s._v("9992")]),s._v(" 两个server。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/terwer/upload/img/image-20220504231718582.png",alt:"image-20220504231718582"}})]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/terwer/upload/img/image-20220504231740884.png",alt:"image-20220504231740884"}})])])])])}),[],!1,null,null,null);n.default=a.exports}}]);